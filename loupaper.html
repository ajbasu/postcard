<!DOCTYPE html>
<html>

<head>
    <title>LouPaper Colllection Tracking - @redteapost</title>
</head>

<body>
    <!-- Styles -->
    <style>
        #chartdiv {
            width: 95vw;
            height: 95vh;
        }

        #link {
            right: 10px;
            bottom: 10px;
            z-index: 20;
            position: absolute;
            font-size: small;
        }
    </style>

    <!-- Resources -->
    <script src="https://cdn.amcharts.com/lib/5/index.js"></script>
    <script src="https://cdn.amcharts.com/lib/5/map.js"></script>
    <script src="https://cdn.amcharts.com/lib/5/geodata/usaLow.js"></script>
    <script src="https://cdn.amcharts.com/lib/5/themes/Animated.js"></script>

    <!-- Chart code -->
    <script>
        am5.ready(function () {

            // Data
            var groupData = [
                {
                    "name": "Received",
                    "data": [
                        { "id": "US-AL", "receivedon": "Will be added" },
                        { "id": "US-AK", "receivedon": "Will be added" },
                        { "id": "US-AZ", "receivedon": "Will be added" },
                        { "id": "US-CA", "receivedon": "Will be added" },
                        { "id": "US-CO", "receivedon": "Will be added" },
                        { "id": "US-CT", "receivedon": "Will be added" },
                        { "id": "US-FL", "receivedon": "Will be added" },
                        { "id": "US-GA", "receivedon": "Will be added" },
                        { "id": "US-HI", "receivedon": "Will be added" },
                        { "id": "US-IL", "receivedon": "Will be added" },
                        { "id": "US-KY", "receivedon": "Will be added" },
                        { "id": "US-LA", "receivedon": "Will be added" },
                        { "id": "US-ME", "receivedon": "Will be added" },
                        { "id": "US-MD", "receivedon": "Will be added" },
                        { "id": "US-MA", "receivedon": "Will be added" },
                        { "id": "US-MI", "receivedon": "Will be added" },
                        { "id": "US-MN", "receivedon": "Will be added" },
                        { "id": "US-MS", "receivedon": "Will be added" },
                        { "id": "US-MO", "receivedon": "Will be added" },
                        { "id": "US-MT", "receivedon": "Will be added" },
                        { "id": "US-NV", "receivedon": "Will be added" },
                        { "id": "US-NJ", "receivedon": "Will be added" },
                        { "id": "US-NY", "receivedon": "Will be added" },
                        { "id": "US-OH", "receivedon": "Will be added" },
                        { "id": "US-OR", "receivedon": "Will be added" },
                        { "id": "US-PA", "receivedon": "Will be added" },
                        { "id": "US-RI", "receivedon": "Will be added" },
                        { "id": "US-SC", "receivedon": "Will be added" },
                        { "id": "US-TN", "receivedon": "Will be added" },
                        { "id": "US-TX", "receivedon": "Will be added" },
                        { "id": "US-VA", "receivedon": "Will be added" },
                        { "id": "US-WA", "receivedon": "Will be added" },
                        { "id": "US-WV", "receivedon": "Will be added" },
                        { "id": "US-WI", "receivedon": "Will be added" },
                    ]
                }, {
                    "name": "Travelling",
                    "data": [

                    ]
                }, {
                    "name": "Yet to Release",
                    "data": [
                        { "id": "US-DE", "receivedon": "Yet to Release" },
                        { "id": "US-IA", "receivedon": "Yet to Release" },
                        { "id": "US-NH", "receivedon": "Yet to Release" },
                        { "id": "US-ND", "receivedon": "Yet to Release" },
                        { "id": "US-SD", "receivedon": "Yet to Release" },
                        { "id": "US-VT", "receivedon": "Yet to Release" },
                    ]
                },
                // }, {
                //     "name": "From tag/offer",
                //     "data": [

                //     ]
                // }
            ];


            // Create root and chart
            var root = am5.Root.new("chartdiv");


            // Set themes
            root.setThemes([
                am5themes_Animated.new(root)
            ]);


            // Create chart
            var chart = root.container.children.push(am5map.MapChart.new(root, {
                panX: "rotateX",
                panY: "none",
                projection: am5map.geoAlbersUsa(),
                layout: root.horizontalLayout
            }));


            // Create world polygon series
            var worldSeries = chart.series.push(am5map.MapPolygonSeries.new(root, {
                geoJSON: am5geodata_usaLow,
                valueField: "value",
                calculateAggregates: true
            }));

            worldSeries.mapPolygons.template.setAll({
                fill: am5.color(0xaaaaaa),
                tooltipText: "{name}"
            });

            worldSeries.events.on("datavalidated", () => {
                chart.goHome();
            });


            // Add legend
            var legend = chart.children.push(am5.Legend.new(root, {
                useDefaultMarker: true,
                centerX: am5.p50,
                x: am5.p50,
                centerY: am5.p100,
                y: am5.p100,
                dy: -20,
                background: am5.RoundedRectangle.new(root, {
                    fill: am5.color(0xffffff),
                    fillOpacity: 0.2
                })
            }));

            legend.valueLabels.template.set("forceHidden", true)


            // Create series for each group
            var colors = am5.ColorSet.new(root, {
                step: 2
            });
            colors.next();

            am5.array.each(groupData, function (group) {
                var countries = [];
                var color = group.name == 'Yet to Release' ? am5.color(0xd3d3d9) : colors.next();;

                am5.array.each(group.data, function (country) {
                    countries.push(country.id)
                });

                var polygonSeries = chart.series.push(am5map.MapPolygonSeries.new(root, {
                    geoJSON: am5geodata_usaLow,
                    include: countries,
                    name: group.name,
                    fill: color,
                }));

                polygonSeries.data.setAll(group.data);

                legend.data.push(polygonSeries);
            });

        }); // end am5.ready()
    </script>

    <!-- HTML -->
    <div id="chartdiv"></div>
    <div id="link"><a href="/postcard/">FOTW</a></div>
</body>

</html>
